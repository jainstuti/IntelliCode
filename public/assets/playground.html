<!DOCTYPE html>
<html lang="en" style="margin-left: -8px">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playground</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"
        integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="css/fontawesome.css">
    <link rel="stylesheet" href="css/templatemo-grad-school.css">
    <link rel="stylesheet" href="css/owl.css">
    <link rel="stylesheet" href="css/lightbox.css">
</head>

<body>
    <!--header-->
    <header class="main-header clearfix" role="header">
        <div class="logo">
            <a href="#"><em>Intelli</em>Code</a>
        </div>
        <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
        <nav id="menu" class="main-nav" role="navigation">
            <ul class="main-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="playground.html">Playground</a></li>
            </ul>
        </nav>
    </header>

    <h1 class="play-head">Playground</h1>

    <label for="language">Language: </label>
    <select name="language" id="language-select">
        <option value="python" selected>Python</option>
        <option value="javascript">Javascript</option>
        <!-- <option value="cpp">C++</option> -->
    </select>

    <div class="editor-container">
        <div id="container" style="width:800px;height:580px;border:1px solid grey"></div>

        <div id="editor-bottom-bar">
            <button id="btn-run">Run</button>
        </div>

        <div id="editor-algo-btn">
            <button id="algo-to-code">Write Code</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.22.3/min/vs/loader.js"></script>
    <script>
        require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.22.3/min/vs' } });
        let editor;

        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('container'), {
                language: 'python',
                theme: 'vs-dark',
                value: [
                    '# Python program to find the factorial of a number provided by the user.',
                    '\n',
                    '# change the value for a different result',
                    'num = 7',
                    '\n',
                    '# To take input from the user',
                    '#num = int(input("Enter a number: "))',
                    '\n',
                    'factorial = 1',
                    '\n',
                    '# check if the number is negative, positive or zero',
                    'if num < 0:',
                    '\tprint("Sorry, factorial does not exist for negative numbers")',
                    'elif num == 0:',
                    '\tprint("The factorial of 0 is 1")',
                    'else:',
                    '\tfor i in range(1,num + 1):',
                    '\t\tfactorial = factorial*i',
                    '\t\tprint("The factorial of", num, "is", factorial)'
                ].join('\n')
            });
        });

        const languageSelect = document.getElementById('language-select')
        languageSelect.addEventListener('change', (event) => {
            monaco.editor.setModelLanguage(editor.getModel(), event.target.value)
        })

        const BASE_URL = 'http://localhost:3001'

        document.getElementById('btn-run').addEventListener('click', async (event) => {
            const data = {
                language: languageSelect.value,
                code: editor.getValue()
            }

            console.log(data)
            const response = await fetch(`${BASE_URL}/code/exec`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
        })

        document.getElementById('algo-to-code').addEventListener('click', async (event) => {
            const data = {
                language: languageSelect.value,
                code: editor.getValue()
            }

            console.log(data)
            const response = await fetch(`${BASE_URL}/code/write`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
        })
    </script>
</body>

</html>